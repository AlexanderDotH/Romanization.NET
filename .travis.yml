language: csharp
mono: none
dotnet: 3.1.402 # to update this value in the future, try `dotnet --list-sdks` as a start

install:
- dotnet restore

script:
- dotnet build RomanizationNet.sln --configuration Release --no-restore
- dotnet test RomanizationTests/RomanizationTests.csproj

before_deploy:
  choco install docfx -y

deploy:
  provider: script
  skip_cleanup: true
  script: chmod +x ./Scripts/deploy.sh && bash ./Scripts/deploy.sh $NUGET_API_KEY $NUGET_SOURCE $GH_PACKAGES_API_KEY $GH_PACKAGES_SOURCE
  on:
    branch: main

# https://stackoverflow.com/a/33125422/6003488
after_success: |
  if [ -n "$GITHUB_API_KEY" ]; then
    cd "$TRAVIS_BUILD_DIR"
    cd Documentation/generated
    git init
    git checkout -b gh-pages
    cd ../..
    chmod +x ./Scripts/buildDoc.sh && bash ./Scripts/buildDoc.sh
    cd Documentation/generated
    git add .
    git -c user.name='travisci' -c user.email='travisci' commit -m "Updating Pages with updated documentation."
    # Make sure to make the output quiet, or else the API token will leak!
    # This works because the API key can replace your password.
    git push -f -q https://zedseven:$GITHUB_API_KEY@github.com/zedseven/Romanization.NET-gh-pages gh-pages &>/dev/null
    cd "$TRAVIS_BUILD_DIR"
  fi
